<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="styles/view.css" rel="stylesheet">

    <!-- Mapbox API -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.css" rel="stylesheet">

    <!--    &lt;!&ndash; Openlayers API &ndash;&gt;-->
    <!--    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.14.1/build/ol.js"></script>-->
    <!--    <link rel="stylesheet"-->
    <!--          href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.14.1/css/ol.css">-->

    <title>全球自然灾害评估系统 - 灾害分布</title>
</head>
<body>
<div id="map"></div>
<div id="view_title">
    <span style="font-family: 'Ubuntu';color: white;font-size: 40px;font-weight: bold;">GNDAS</span>
    <span style="font-family: 'Microsoft YaHei';color: white;font-size: 30px;font-weight: bold;">灾害分布</span>
    <div id="shining_bar"></div>
    <div style="font-family: 'Ubuntu';color: #1da1f2;font-size: 11px;letter-spacing: 1px;display: block; margin-top:2%;">
        GLOBAL NATURAL DISASTER ASSESSMENT SYSTEM
    </div>
</div>
<div id="control">
    <div style="display: block; height: 100px;"></div>
    <div class="func">灾害种类</div>
    <div class="content">
        <div class="type">火&nbsp;&nbsp;山</div>
        <div class="type">地&nbsp;&nbsp;震</div>
        <div class="type">海&nbsp;&nbsp;啸</div>
    </div>
    <div class="func">更改底图</div>
    <div class="content">
        <div class="style">卫&nbsp;星</div>
        <div class="style">街&nbsp;景</div>
        <div class="style">明&nbsp;亮</div>
        <div class="style">暗&nbsp;黑</div>
    </div>
    <div class="func">数据统计</div>
    <div class="content">
    </div>
</div>
<div class="flex">
    <ul>
        <li>灾害分布</li>
        <li>风险评估</li>
        <li>用户论坛</li>
        <li>数据管理</li>
        <div class="bar"></div>
    </ul>
</div>
<div id="panel_bg1"></div>
<div id="panel_bg2"></div>
<div id="info2">
    <div class="user_date">{{ usr }}</div>
    <div class="info_item">系统权限</div>
    <div id="item_c1">{{ pms }}</div>
</div>
<div id="info1">
    <div class="user_date">当前时间</div>
    <div class="info_item">当前收录</div>
    <div id="item_c2">28,653</div>
    <div class="info_item">最近灾害</div>
    <div id="item_c3">汤加 [112, 23] 火山</div>
</div>


<!-- Mapbox -->
<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoic3Nzc3BoaW54IiwiYSI6ImNrbnZnbDR1NzAzNzMyb3Bwbng3amtnMzQifQ.E1nAH_fti0KvB2heCd-cEg';
    const map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/satellite-streets-v11', // style URL
        center: [105, 45], // starting position [lng, lat]
        zoom: 1.2, // starting zoom
    });

    // var vol, eqk, tnm
    // window.onload = function () {
    //     let url = 'http://127.0.0.1:8080/result'
    //     let xhr1 = new XMLHttpRequest();
    //     xhr1.open('POST', url, true);
    //     let formData1 = new FormData();
    //     formData1.append('status', 'disaster')
    //     formData1.append('type', 'volcano')
    //     xhr1.send(formData1)
    //     xhr1.onreadystatechange = function () {
    //         if (xhr1.readyState === XMLHttpRequest.DONE && xhr1.status === 200) {
    //             vol = xhr1.response
    //         }
    //     }
    //     let xhr2 = new XMLHttpRequest();
    //     xhr2.open('POST', url, true);
    //     let formData2 = new FormData();
    //     formData2.append('status', 'disaster')
    //     formData2.append('type', 'earthquake')
    //     xhr2.send(formData2)
    //     xhr2.onreadystatechange = function () {
    //         if (xhr2.readyState === XMLHttpRequest.DONE && xhr2.status === 200) {
    //             eqk = xhr2.response
    //         }
    //     }
    //     let xhr3 = new XMLHttpRequest();
    //     xhr3.open('POST', url, true);
    //     let formData3 = new FormData();
    //     formData3.append('status', 'disaster')
    //     formData3.append('type', 'tsunami')
    //     xhr3.send(formData3)
    //     xhr3.onreadystatechange = function () {
    //         if (xhr3.readyState === XMLHttpRequest.DONE && xhr3.status === 200) {
    //             tnm = xhr3.response
    //         }
    //     }
    // }
    // console.log(vol)
    // console.log(typeof(vol))

    // console.log('{{ vol }}')
    // console.log(JSON.parse('{{ vol }}'))
    // console.log(typeof ('{{ vol }}'))
    // console.log(typeof (JSON.parse('{{ vol }}')))

    // map.on('load', () => {
    //     map.addSource('volcano', {
    //         'type': 'geojson',
    //         'data': vol
    //     });
    //
    //     // Add a layer showing the places.
    //     map.addLayer({
    //         'id': 'volcano',
    //         'type': 'circle',
    //         'source': 'volcano',
    //         'paint': {
    //             'circle-color': '#9D4E54',
    //             'circle-radius': 5,
    //             'circle-stroke-width': 1,
    //             'circle-stroke-color': '#ffffff'
    //         }
    //     });
    //
    //     // map.on('click', 'heritages', (e) => {
    //     //     // Copy coordinates array.
    //     //     const coordinates = e.features[0].geometry.coordinates.slice();
    //     //     dest = coordinates;
    //     //     const name = e.features[0].properties.Name;
    //     //     const e_class = e.features[0].properties.Class;
    //     //     const code = e.features[0].properties.Code;
    //     //     const protect = e.features[0].properties.Protect;
    //     //     const content = e.features[0].properties.Content;
    //     //     const time = e.features[0].properties.Time;
    //     //     const people = e.features[0].properties.People;
    //     //     const No = e.features[0].properties.No;
    //     //
    //     //
    //     //     while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
    //     //         coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
    //     //     }
    //     //
    //     //     new mapboxgl.Popup({
    //     //         closeButton: false
    //     //     })
    //     //         .setLngLat(coordinates)
    //     //         .setHTML('<p><b>' + name + '</b></p><hr>' + '编号： <span lang="en">' +
    //     //             code + '</span><br>类别： ' + e_class + '<br>保护单位： ' + protect)
    //     //         .addTo(map);
    //     //
    //     //     map.flyTo({
    //     //         center: e.features[0].geometry.coordinates,
    //     //         zoom: 12
    //     //     });
    //     // });
    //     //
    //     // const popup = new mapboxgl.Popup({
    //     //     closeButton: false,
    //     //     closeOnClick: false
    //     // });
    //     // // Change the cursor to a pointer when the mouse is over the places layer.
    //     // map.on('mouseenter', 'heritages', (e) => {
    //     //     map.getCanvas().style.cursor = 'pointer';
    //     //
    //     //     // Copy coordinates array.
    //     //     const coordinates = e.features[0].geometry.coordinates.slice();
    //     //     const name = e.features[0].properties.Name;
    //     //     const e_class = e.features[0].properties.Class;
    //     //     const code = e.features[0].properties.Code;
    //     //     const protect = e.features[0].properties.Protect;
    //     //
    //     //     while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
    //     //         coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
    //     //     }
    //     //
    //     //     popup.setLngLat(coordinates)
    //     //         .setHTML('<p><b>' + name + '</b></p><hr>' + '编号： <span lang="en">' +
    //     //             code + '</span><br>类别： ' + e_class + '<br>保护单位： ' + protect)
    //     //         .addTo(map);
    //     // });
    //     //
    //     // // Change it back to a pointer when it leaves.
    //     // map.on('mouseleave', 'heritages', () => {
    //     //     map.getCanvas().style.cursor = '';
    //     //
    //     //     popup.remove();
    //     // });
    //     //
    //     // map.on('mousemove', (e) => {
    //     //     // `e.lngLat` is the longitude, latitude geographical position of the event.
    //     //     document.getElementById('info').innerHTML = '<table><tr><td style="width: 50px;">' +
    //     //         '经度:' + '</td><td style="width: 150px;" lang="en">' + e.lngLat.lng.toFixed(13) + '</td><td style="width: 50px;">' +
    //     //         '纬度:' + '</td><td style="width: 150px;" lang="en">' + e.lngLat.lat.toFixed(13) + '</td></tr></table>'
    //     // });
    // });

    const func = document.getElementsByClassName('func');
    const type = document.getElementsByClassName('type');
    const style = document.getElementsByClassName('style');
    const shining_bar = document.getElementById('shining_bar');
    const flex = document.getElementsByClassName('flex')[0];
    const bar = document.getElementsByClassName('bar')[0];
    const info_item = document.getElementsByClassName('info_item');
    const item_c1 = document.getElementById('item_c1');
    const item_c2 = document.getElementById('item_c2');
    const item_c3 = document.getElementById('item_c3');
    const user = document.getElementsByClassName('user_date')[0];
    const time = document.getElementsByClassName("user_date")[1];

    for (let i = 0; i < func.length; i++) {
        func[i].classList.add('show');
    }

    let types = [false, false, false]
    for (let i = 0; i < type.length; i++) {
        type[i].classList.add('show');
        type[i].onclick = function () {
            if (types[i] === false) {
                type[i].classList.add('clicked');
                types[i] = true;
            } else {
                type[i].classList.remove('clicked');
                types[i] = false;
            }

            // let url = 'http://127.0.0.1:8080/result'
            // let xhr = new XMLHttpRequest();
            // xhr.open('POST', url, true);
            // let formData = new FormData();
            // formData.append('status', 'type')
            // formData.append('dis', i.toString())
            // xhr.send(formData)
            // xhr.onreadystatechange = function () {
            //     if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            //
            //     }
            // }
        }
    }

    let styles = ['satellite-streets-v11', 'streets-v11', 'light-v10', 'dark-v10']
    let styles_c = [true, false, false, false]
    style[0].classList.add('clicked');
    for (let i = 0; i < style.length; i++) {
        style[i].classList.add('show');
        style[i].onclick = function () {
            if (styles_c[i] === false) {
                let c_id = styles_c.indexOf(true);
                style[c_id].classList.remove('clicked');
                styles_c[c_id] = false;
                style[i].classList.add('clicked');
                styles_c[i] = true;
                map.setStyle('mapbox://styles/mapbox/' + styles[i])
            }
        }
    }

    for (let i = 0; i < info_item.length; i++) {
        info_item[i].classList.add('show');
    }

    shining_bar.classList.add('show');
    flex.classList.add('show');
    bar.classList.add('show1');
    user.classList.add('show1');
    item_c1.classList.add('show');
    item_c2.classList.add('show');
    item_c3.classList.add('show');
    time.classList.add('show2');

    function getDate() {
        let date = new Date();
        time.innerHTML = date.toLocaleString();
    }

    getDate()
    setInterval("getDate()", 1000);

    const li = document.getElementsByTagName('li');
    li[1].onclick = function () {
        window.location.href = "risk.html";
    }
    li[2].onclick = function () {
        window.location.href = "discussion.html";
    }
    li[3].onclick = function () {
        window.location.href = "data.html";
    }
</script>
</body>
</html>